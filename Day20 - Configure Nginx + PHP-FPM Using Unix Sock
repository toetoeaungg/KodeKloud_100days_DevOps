# 1. Update and install Nginx
sudo apt update -y
sudo apt install nginx -y

# 2. Edit main config
sudo nano /etc/nginx/nginx.conf
# Change
Listen  80;       ---> Listen 8096;

# 3. Test Nginx config
sudo nginx -t

# 4. Restart Nginx
sudo systemctl restart nginx

--------

## Install php-fpm version 8.2
# 1. Enable Remi repo for PHP
sudo dnf install -y https://dl.fedoraproject.org/pub/epel/epel-release-latest-$(rpm -E %rhel).noarch.rpm
sudo dnf install -y https://rpms.remirepo.net/enterprise/remi-release-$(rpm -E %rhel).rpm

# 2. Enable PHP 8.2 module
sudo dnf module reset php
sudo dnf module enable php:remi-8.2

# 3. Install PHP-FPM and common extensions
sudo dnf install php-fpm php-cli php-mysqlnd php-gd php-opcache php-xml php-mbstring

# 4. Enable and start service
sudo systemctl start php-fpm
sudo systemctl enable php-fpm

# 5. Verify version
php -v

-------

### Configure PHP-FPM to use /var/run/php-fpm/default.sock
# RHEL/CentOS
sudo nano /etc/php-fpm.d/www.conf

# Findh the line and change it to
listen = /run/php/php8.2-fpm.sock     ---> listen = /var/run/php-fpm/default.sock

# Ensure the socket directory exists: if not exit create it
sudo chown -R nginx:nginx /var/run/php-fpm          # RHEL/CentOS

# Restart PHP-FPM
sudo systemctl restart php-fpm
sudo systemctl enable php-fpm

# Verify the socket;
ls -l /var/run/php-fpm/default.sock

-------

#### Configure Nginx to Work with PHP-FPM
# edit Nginx site config:
sudo nano /etc/nginx/conf.d/default.conf           # RHEL/CentOS

# nside the server { ... } block, add PHP handling

server {
    listen 8096 default_server;

    root /var/www/html;
    index index.php index.html index.htm;

    server_name _;

    location / {
        try_files $uri $uri/ =404;
    }

    location ~ \.php$ {
        include snippets/fastcgi-php.conf;   # Ubuntu/Debian
        #include fastcgi_params;             # RHEL/CentOS alternative

        fastcgi_pass unix:/var/run/php-fpm/default.sock;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }
}

# Test Nginx config:
sudo nginx -t
sudo systemctl restart nginx

##### Test PHP-FPM + Nginx Integration
echo "<?php phpinfo(); ?>" | sudo tee /var/www/html/info.php
http://<server-ip>:8096/info.php
